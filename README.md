# AI旅行规划师 (AI Travel Planner)

基于Flutter Web的智能旅行规划应用，集成AI技术简化旅行规划过程。

## 项目概述

本项目是一个Web版的AI旅行规划工具，通过AI了解用户需求，自动生成详细的旅行路线和建议，并提供实时旅行辅助功能。

## 技术栈

- **前端**: Flutter Web
- **后端**: Python + FastAPI
- **数据库**: SQLite (初期)
- **AI服务**: OpenAI API (默认DeepSeek-chat)
- **地图服务**: 高德地图API
- **语音识别**: 科大讯飞语音识别API
- **搜索服务**: 智谱GLM搜索API

## 核心功能

1. **智能行程规划**: 通过语音或文字输入生成个性化旅行路线
2. **费用预算与管理**: AI预算分析和旅行开销记录
3. **用户管理与数据存储**: 注册登录系统，云端行程同步
   - **安全认证**: 使用SRP协议确保密码在不安全传输中不被泄露
   - **数据加密**: 行程数据使用用户密码加密，后端只存储加密数据，前端负责解密
4. **地图导航**: 基于高德地图的地理位置服务和导航
5. **语音识别**: 基于科大讯飞API的语音输入功能

## 项目结构

```
ai-travel-planner/
├── backend/                 # Python后端服务
│   ├── app/                # 应用代码
│   ├── requirements.txt    # Python依赖
│   └── pyproject.toml      # uv配置
├── frontend/               # Flutter前端应用
│   ├── lib/               # Dart代码
│   ├── pubspec.yaml       # Flutter依赖
│   └── web/               # Web配置
├── docs/                  # 项目文档
├── config/               # 配置文件
└── README.md            # 项目说明
```

## 开发环境要求

- Python 3.9+
- Flutter 3.0+ (Web支持)
- uv (Python包管理器)

## 快速开始

### 后端启动
```bash
cd backend
uv run uvicorn app.main:app --reload
```

### 前端启动
```bash
cd frontend
flutter run -d chrome
```

## 配置说明

**重要：所有API密钥将与用户账户绑定，每个用户只能使用自己设置的API密钥。系统不会使用任何全局或默认的API密钥。**

用户可在账户设置界面配置以下API密钥：
- OpenAI API Key
- 高德地图API Key
- 科大讯飞语音识别API Key
- 智谱GLM搜索API Key

API密钥为空时相关服务不可用，但不影响其他服务的使用。

## 数据安全架构

### 加密数据存储设计

本项目采用端到端加密设计，确保用户行程数据的安全性：

- **后端职责**: 只负责存储加密数据，不处理业务逻辑
- **前端职责**: 负责数据加密解密和所有业务逻辑处理
- **加密机制**: 使用用户登录密码派生密钥进行AES加密

### 加密数据流

1. **数据创建**:
   - 前端使用用户密码加密行程数据
   - 发送加密数据到后端存储
   - 后端只验证用户身份，不处理数据内容

2. **数据读取**:
   - 前端从后端获取加密数据
   - 使用用户密码解密数据
   - 在客户端处理所有业务逻辑

3. **数据更新**:
   - 前端加密更新后的数据
   - 发送加密数据到后端
   - 后端直接存储，不进行业务验证

### SRP安全认证机制

本项目使用SRP（Secure Remote Password）协议来增强用户认证安全性，确保密码在不安全的网络传输中不会被泄露。

#### SRP协议优势

- **零知识证明**: 服务器不存储用户密码，只存储验证器
- **中间人攻击防护**: 即使传输被监听，攻击者也无法获取密码
- **相互认证**: 客户端和服务器相互验证身份
- **前向安全性**: 即使验证器泄露，也无法推导出原始密码

#### SRP认证流程

1. **注册流程**:
   - 客户端发送用户名、邮箱和密码
   - 服务器生成SRP盐值和验证器
   - 服务器存储用户名、邮箱、盐值和验证器

2. **登录流程**:
   - 客户端请求认证挑战
   - 服务器返回盐值和服务器公钥
   - 客户端生成客户端公钥和证明
   - 服务器验证客户端证明并返回服务器证明
   - 客户端验证服务器证明，完成相互认证

#### API端点

- `POST /auth/srp/register` - SRP用户注册
- `POST /auth/srp/challenge` - 获取SRP认证挑战
- `POST /auth/srp/authenticate` - 进行SRP认证

#### 测试SRP认证

运行测试脚本验证SRP认证流程：
```bash
cd backend
uv run python test_srp_auth.py
```

### 加密存储机制测试

运行端到端加密工作流测试验证加密数据存储机制：
```bash
cd backend
uv run python test_full_encrypted_workflow.py
```

测试验证内容：
- ✓ 前端加密行程数据
- ✓ 后端存储加密数据
- ✓ 前端获取加密数据
- ✓ 前端解密数据
- ✓ 验证数据一致性

## 许可证

[待添加]